<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WKPUP Simulation - Job Submission</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>WKPUP Simulation System</h1>
            <p class="subtitle">Wrapper for Pai Ho's Validated wkpup2 Core</p>
        </header>

        <nav>
            <a href="/" class="active">Submit Job</a>
            <a href="/results">View Results</a>
            <a href="/api/queue/status" target="_blank">Queue Status</a>
        </nav>

        <main>
            <section class="queue-status">
                <h2>Queue Status</h2>
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-value">{{ queue_status['queued_jobs'] }}</div>
                        <div class="status-label">Queued</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value">{{ queue_status['active_jobs'] }}</div>
                        <div class="status-label">Running</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value">{{ queue_status['available_workers'] }}</div>
                        <div class="status-label">Available Workers</div>
                    </div>
                </div>
            </section>

            <section class="job-submission">
                <h2>Submit New Job</h2>
                
                <form id="jobForm" method="POST" action="/">
                    <div class="form-grid">
                        <!-- Mode -->
                        <div class="form-group">
                            <label for="mode">Mode *</label>
                            <select id="mode" name="mode" required>
                                <option value="prelay">Pre-layout</option>
                                <option value="postlay">Post-layout</option>
                            </select>
                        </div>

                        <!-- VCCN -->
                        <div class="form-group">
                            <label for="vccn">VCCN Voltage *</label>
                            <select id="vccn" name="vccn" required>
                                <option value="1p1v">1.1V</option>
                                <option value="1p2v">1.2V</option>
                                <option value="1p8v">1.8V</option>
                                <option value="1p15v">1.15V</option>
                            </select>
                        </div>

                        <!-- VCCTX -->
                        <div class="form-group">
                            <label for="vcctx">VCCTX Voltage</label>
                            <input type="text" id="vcctx" name="vcctx" value="1p0v">
                        </div>

                        <!-- Sim Mode -->
                        <div class="form-group">
                            <label for="sim_mode">Simulation Mode *</label>
                            <select id="sim_mode" name="sim_mode" required>
                                <option value="ac">AC Mode</option>
                                <option value="dc">DC Mode</option>
                            </select>
                        </div>

                        <!-- Condition -->
                        <div class="form-group">
                            <label for="condition">Condition *</label>
                            <select id="condition" name="condition" required>
                                <option value="perf">Performance</option>
                                <option value="func">Functional</option>
                                <option value="htol">HTOL</option>
                            </select>
                        </div>

                        <!-- Simulator -->
                        <div class="form-group">
                            <label for="simulator">Simulator *</label>
                            <select id="simulator" name="simulator" required>
                                <option value="primesim">PrimeSim</option>
                                <option value="finesim">FineSim</option>
                            </select>
                        </div>

                        <!-- CPU Count -->
                        <div class="form-group">
                            <label for="CPU">CPU Count *</label>
                            <input type="number" id="CPU" name="CPU" value="16" min="1" max="128" required>
                        </div>

                        <!-- Memory -->
                        <div class="form-group">
                            <label for="MEM">Memory *</label>
                            <input type="text" id="MEM" name="MEM" value="32G" pattern="[0-9]+[GM]" required>
                            <small>Format: 32G or 4096M</small>
                        </div>

                        <!-- Domain Path -->
                        <div class="form-group full-width">
                            <label for="domain_path">Domain Path *</label>
                            <input type="text" id="domain_path" name="domain_path" placeholder="gpio/1p1v" required>
                            <small>Example: gpio/1p1v, i3c/1p2v</small>
                        </div>

                        <!-- Supply Voltages -->
                        <div class="form-group">
                            <label for="1st_supply_swp">1st Supply Sweep</label>
                            <input type="text" id="1st_supply_swp" name="1st_supply_swp" value="v1nom">
                        </div>

                        <div class="form-group">
                            <label for="2nd_supply_swp">2nd Supply Sweep</label>
                            <input type="text" id="2nd_supply_swp" name="2nd_supply_swp" value="v2nom">
                        </div>

                        <div class="form-group">
                            <label for="3rd_supply_swp">3rd Supply Sweep</label>
                            <input type="text" id="3rd_supply_swp" name="3rd_supply_swp" value="v3nom">
                        </div>

                        <!-- User -->
                        <div class="form-group">
                            <label for="user">User</label>
                            <input type="text" id="user" name="user" value="web_user">
                        </div>

                        <!-- Description -->
                        <div class="form-group full-width">
                            <label for="description">Description</label>
                            <textarea id="description" name="description" rows="3" placeholder="Optional job description"></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Submit Job</button>
                        <button type="reset" class="btn btn-secondary">Reset Form</button>
                    </div>
                </form>

                <div id="submitResult" class="result-message" style="display: none;"></div>
            </section>
        </main>

        <footer>
            <p>&copy; 2025 WKPUP Reconciliation Project | Zero modifications to Pai Ho's core files</p>
        </footer>
    </div>

    <script>
        // Job submission handling
        document.getElementById('jobForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const resultDiv = document.getElementById('submitResult');
            
            try {
                const response = await fetch('/', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'result-message success';
                    resultDiv.innerHTML = `
                        <strong>Success!</strong> Job submitted: ${data.job_id}<br>
                        <a href="/results/${data.job_id}">View Job Status</a>
                    `;
                    this.reset();
                } else {
                    resultDiv.className = 'result-message error';
                    resultDiv.innerHTML = `<strong>Error:</strong> ${data.error}`;
                }
                
                resultDiv.style.display = 'block';
                
            } catch (error) {
                resultDiv.className = 'result-message error';
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                resultDiv.style.display = 'block';
            }
        });
    </script>
</body>
</html>
